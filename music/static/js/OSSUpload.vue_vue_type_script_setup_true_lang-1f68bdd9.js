import{M as u,U as S,H as f,A as m,u as _}from"./uploadConstant-bf884d01.js";import{j as l}from"./song-0e6f7ac3.js";import{d as y,t as T,r as d,o as h,i as k,j as p,e as w,h as g,z as K,f as o,ax as b}from"./index-b0f6dbf0.js";const A=y({name:"OSSUpload",__name:"OSSUpload",emits:["progress","success"],setup(x,{emit:n}){let c=null,r="";async function i(e){if(c){const a=`${Date.now()}-${e.file.name}`;try{const s=await c.multipartUpload(`/music/${a}`,e.file,{progress:t=>n("progress",Number(t*100).toFixed(0))});if(s.name&&(s==null?void 0:s.res.status)===200){const t=r+s.name;n("success",t)}}catch{}}else b("获取阿里云OSS实例失败，请刷新后重试",{type:"error"})}return T(async()=>{const e=await l();r=e.region,c=new window.OSS({region:"oss-cn-chengdu",accessKeyId:e.accessKeyId,accessKeySecret:e.accessKeySecret,stsToken:e.stsToken,bucket:e.bucket,refreshSTSToken:async()=>{const a=await l();return{accessKeyId:a.accessKeyId,accessKeySecret:a.accessKeySecret,stsToken:a.stsToken}},refreshSTSTokenInterval:3e5})}),(e,a)=>{const s=d("el-button"),t=d("el-upload");return h(),k(t,{action:o(S),headers:o(f),"show-file-list":!1,accept:o(m),"before-upload":o(_),"http-request":i},{default:p(()=>[w(s,{type:"primary"},{default:p(()=>[g("点击上传OSS(大小限制"+K(o(u))+")",1)]),_:1})]),_:1},8,["action","headers","accept","before-upload"])}}});export{A as _};
