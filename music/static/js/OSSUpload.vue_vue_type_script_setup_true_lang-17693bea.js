import{u as U,a as k,M as C}from"./useOSS-4b2adf5e.js";import{d as D,p as d,n as m,r as l,b as z,o as f,c as B,w as E,i as N,j as u,e as c,f as i,h as T,z as $,O as j,ax as M}from"./index-17a497b2.js";const P={class:"w-full"},A=D({name:"OSSUpload",__name:"OSSUpload",props:{modelValue:String},emits:["update:modelValue"],setup(_,{emit:v}){const S=_,n=d({get(){return S.modelValue},set(e){v("update:modelValue",e)}}),{client:p,downloadPrefix:g}=U(),s=m(0),w=d(()=>{const e=s.value;return e>=0&&e<=50?"exception":e>50&&e<100?"warning":e>=100?"success":""}),r=m(!1),x=[".wav",".flac",".aac",".ogg",".aiff",".wma",".mp3"].join(",");async function V(e){if(p.value!=null){r.value=!0;const o=`${Date.now()}-${e.file.name}`;try{const a=await p.value.multipartUpload(`/music/${o}`,e.file,{progress:t=>s.value=Number((t*100).toFixed(0))});if(a.name&&(a==null?void 0:a.res.status)===200){const t=g.value+a.name;n.value=t}}catch{}r.value=!1}else M("获取阿里云OSS实例失败，请刷新后重试",{type:"error"})}return(e,o)=>{const a=l("el-button"),t=l("el-upload"),h=l("el-input"),O=l("el-progress"),b=z("loading");return f(),B("div",P,[E((f(),N(h,{modelValue:n.value,"onUpdate:modelValue":o[0]||(o[0]=y=>n.value=y),placeholder:"请上传文件后待返回OSS链接"},{append:u(()=>[c(t,{multiple:!1,"show-file-list":!1,accept:i(x),"before-upload":i(k),"http-request":V},{default:u(()=>[c(a,{type:"primary"},{default:u(()=>[T("点击上传OSS(大小限制"+$(i(C))+")",1)]),_:1})]),_:1},8,["accept","before-upload"])]),_:1},8,["modelValue"])),[[b,r.value]]),c(O,{class:j(["mt-1",s.value>0?"flex":"hidden"]),"text-inside":"","stroke-width":16,percentage:s.value,status:w.value},null,8,["class","percentage","status"])])}}});export{A as _};
