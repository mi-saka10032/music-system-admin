import{M as S,U as f,H as m,u as _}from"./uploadConstant-99e56d36.js";import{j as l}from"./song-361d1acd.js";import{d as y,t as w,r as i,o as T,i as g,j as p,e as h,h as k,z as K,f as o,ax as b}from"./index-b9fe2a94.js";const D=y({name:"OSSUpload",__name:"OSSUpload",emits:["progress","success"],setup(x,{emit:n}){const d=[".wav",".flac",".aac",".ogg",".aiff",".wma",".mp3"].join(",");let c=null,r="";async function u(e){if(c){const a=`${Date.now()}-${e.file.name}`;try{const s=await c.multipartUpload(`/music/${a}`,e.file,{progress:t=>n("progress",Number(t*100).toFixed(0))});if(s.name&&(s==null?void 0:s.res.status)===200){const t=r+s.name;n("success",t)}}catch{}}else b("获取阿里云OSS实例失败，请刷新后重试",{type:"error"})}return w(async()=>{const e=await l();r=e.region,c=new window.OSS({region:"oss-cn-chengdu",accessKeyId:e.accessKeyId,accessKeySecret:e.accessKeySecret,stsToken:e.stsToken,bucket:e.bucket,refreshSTSToken:async()=>{const a=await l();return{accessKeyId:a.accessKeyId,accessKeySecret:a.accessKeySecret,stsToken:a.stsToken}},refreshSTSTokenInterval:3e5})}),(e,a)=>{const s=i("el-button"),t=i("el-upload");return T(),g(t,{action:o(f),headers:o(m),"show-file-list":!1,accept:o(d),"before-upload":o(_),"http-request":u},{default:p(()=>[h(s,{type:"primary"},{default:p(()=>[k("点击上传OSS(大小限制"+K(o(S))+")",1)]),_:1})]),_:1},8,["action","headers","accept","before-upload"])}}});export{D as _};
