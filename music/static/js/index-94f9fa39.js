import{u as W,a as u}from"./song-3431cc8a.js";import{u as X,a as Z,b as ee,c as ne}from"./useDelete-60b50bf2.js";import{e as D}from"./mitt-7f99bbc0.js";import{c as ae,u as oe,g as te,d as h,a as re}from"./singer-edb6f20a.js";import{d as se,p as le,Y as m,e as n,ar as g,r as d,as as b,h as N,t as ie,a6 as ue,o as ce,c as me,f as o,j as ge,at as _}from"./index-7abcff81.js";import{_ as de}from"./RelatedSongsTable.vue_vue_type_script_setup_true_lang-5d3627b6.js";const he=se({name:"Singer",__name:"index",setup(fe){const{loading:y,tableColumns:f,tableData:p,pagination:i,checkedIds:C,openLoading:B,closeLoading:w,injectCheckedIds:I,handleCurrentPageChange:U,handlePageSizeChange:x,resetPagination:P}=W(),{queryForm:c,queryFormColumns:L,resetQueryForm:R}=X({singerName:"",coverUrl:""},u().singerFormColumns),{createForm:v,createFormColumns:k,resetCreateForm:M,createSuccessMsg:z}=Z({id:null,singerName:"",coverUrl:""},u().singerFormColumns),{updateForm:t,updateFormColumns:E,resetUpdateForm:V,updateSuccessMsg:Q}=ee({id:null,singerName:"",coverUrl:""},u().singerFormColumns),{deleteSuccessMsg:S,deleteNoCheckedMsg:T}=ne();f.value=u().singerTableColumns;const $=le(()=>({singerName:c.singerName,coverUrl:c.coverUrl,pageNo:i.currentPage,pageSize:i.pageSize})),j=m({title:"歌手信息新增",contentRenderer:()=>n(g,{formValue:v,formColumns:k,showButton:!1,isFlex:!1},null),beforeSure:async e=>{await ae(v),z(),e(),a()}}),q=m({title:"歌手信息编辑",contentRenderer:()=>n(g,{formValue:t,formColumns:E,showButton:!1,isFlex:!1},null),beforeSure:async e=>{await oe(t),Q(),e(),a()}}),A=m({title:"歌手-关联歌曲详情",contentRenderer:()=>n("div",null,[n(d("el-row"),{class:"mt-5 mb-5"},{default:()=>[n(b,{value:12},{default:()=>[N("歌手ID："),t.id]}),n(b,{value:12},{default:()=>[N("歌手名称："),t.singerName]})]}),n(de,{relatedId:t.id,relation:"singer"},null)]),footerRenderer:()=>n("div",null,null)});async function a(){B();try{const e=await te($.value);p.value=e.list,i.total=e.total}catch{}w()}function H(){R(),P(),a()}async function Y(e){await h(e),S(),a()}async function G(){C.value.length>0?(await Promise.all(C.value.map(e=>h(e))),S(),a()):T()}function J(){M(),_(j)}async function F(e,r){V();const l=await re(r);t.id=l.id,t.singerName=l.singerName,t.coverUrl=l.coverUrl,_(e)}return ie(()=>{a(),D.on("openSingerSongsDialog",e=>{F(A,Number(e))})}),ue(()=>{D.off("openSingerSongsDialog")}),(e,r)=>{const l=d("InlineButton"),K=d("pure-table");return ce(),me("div",null,[n(g,{"form-value":o(c),"form-columns":o(L),"show-button":!0,"is-flex":!0,onQuery:a,onReset:H,onCreate:J,onDelete:G},null,8,["form-value","form-columns"]),n(K,{loading:o(y),columns:o(f),data:o(p),pagination:o(i),onSelectionChange:o(I),onPageCurrentChange:r[0]||(r[0]=s=>o(U)(s,a)),onPageSizeChange:r[1]||(r[1]=s=>o(x)(s,a))},{operation:ge(({row:s})=>[n(l,{onInlineEdit:O=>F(q,s.id),onInlineDelete:O=>Y(s.id)},null,8,["onInlineEdit","onInlineDelete"])]),_:1},8,["loading","columns","data","pagination","onSelectionChange"])])}}});export{he as default};
