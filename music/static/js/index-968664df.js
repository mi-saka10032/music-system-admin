import{u as W,a as m}from"./song-3431cc8a.js";import{u as X,a as Z,b as ee,c as ae}from"./useDelete-60b50bf2.js";import{e as S}from"./mitt-7f99bbc0.js";import{c as te,u as le,g as ne,d as P,a as oe}from"./album-c798d7d5.js";import{d as ue,p as se,Y as c,e as a,ar as d,r as b,as as p,h as f,t as re,a6 as ie,o as me,c as ce,f as n,j as de,at as T}from"./index-7abcff81.js";import{_ as be}from"./RelatedSongsTable.vue_vue_type_script_setup_true_lang-5d3627b6.js";const De=ue({name:"Album",__name:"index",setup(pe){const{loading:_,tableColumns:g,tableData:C,pagination:i,checkedIds:h,openLoading:y,closeLoading:N,injectCheckedIds:A,handleCurrentPageChange:w,handlePageSizeChange:I,resetPagination:U}=W(),{queryForm:r,queryFormColumns:x,resetQueryForm:B}=X({albumName:"",coverUrl:"",startPublishTime:null,endPublishTime:null},m().albumQueryFormColumns),{createForm:F,createFormColumns:E,resetCreateForm:L,createSuccessMsg:R}=Z({id:null,albumName:"",coverUrl:"",publishTime:null},m().albumDetailFormColumns),{updateForm:t,updateFormColumns:k,resetUpdateForm:M,updateSuccessMsg:z}=ee({id:null,albumName:"",coverUrl:"",publishTime:null},m().albumDetailFormColumns),{deleteSuccessMsg:v,deleteNoCheckedMsg:Q}=ae();g.value=m().albumTableColumns;const V=se(()=>({albumName:r.albumName,coverUrl:r.coverUrl,startPublishTime:r.startPublishTime,endPublishTime:r.endPublishTime,pageNo:i.currentPage,pageSize:i.pageSize})),$=c({title:"专辑信息新增",contentRenderer:()=>a(d,{formValue:F,formColumns:E,showButton:!1,isFlex:!1},null),beforeSure:async e=>{await te(F),R(),e(),l()}}),j=c({title:"专辑信息编辑",contentRenderer:()=>a(d,{formValue:t,formColumns:k,showButton:!1,isFlex:!1},null),beforeSure:async e=>{await le(t),z(),e(),l()}}),q=c({title:"专辑-关联歌曲详情",contentRenderer:()=>a("div",null,[a(b("el-row"),{class:"mt-5 mb-5"},{default:()=>[a(p,{value:8},{default:()=>[f("专辑ID："),t.id]}),a(p,{value:8},{default:()=>[f("专辑名称："),t.albumName]}),a(p,{value:8},{default:()=>[f("发行日期："),t.publishTime]})]}),a(be,{relatedId:t.id,relation:"album"},null)]),footerRenderer:()=>a("div",null,null)});async function l(){y();try{const e=await ne(V.value);C.value=e.list,i.total=e.total}catch{}N()}function H(){B(),U(),l()}async function Y(e){await P(e),v(),l()}async function G(){h.value.length>0?(await Promise.all(h.value.map(e=>P(e))),v(),l()):Q()}function J(){L(),T($)}async function D(e,o){M();const u=await oe(o);t.id=u.id,t.albumName=u.albumName,t.coverUrl=u.coverUrl,t.publishTime=u.publishTime,T(e)}return re(()=>{l(),S.on("openAlbumSongsDialog",e=>{D(q,Number(e))})}),ie(()=>{S.off("openAlbumSongsDialog")}),(e,o)=>{const u=b("InlineButton"),K=b("pure-table");return me(),ce("div",null,[a(d,{class:"simple_form","form-value":n(r),"form-columns":n(x),"show-button":!0,"is-flex":!0,onQuery:l,onReset:H,onCreate:J,onDelete:G},null,8,["form-value","form-columns"]),a(K,{loading:n(_),columns:n(g),data:n(C),pagination:n(i),onSelectionChange:n(A),onPageCurrentChange:o[0]||(o[0]=s=>n(w)(s,l)),onPageSizeChange:o[1]||(o[1]=s=>n(I)(s,l))},{operation:de(({row:s})=>[a(u,{onInlineEdit:O=>D(j,s.id),onInlineDelete:O=>Y(s.id)},null,8,["onInlineEdit","onInlineDelete"])]),_:1},8,["loading","columns","data","pagination","onSelectionChange"])])}}});export{De as default};
